<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Fullscreen Map Centered on US</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <!-- Optional: Leaflet Fullscreen plugin CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-fullscreen@1.0.2/dist/leaflet.fullscreen.css" />
    
    <style>
        /* Make the map take the full screen */
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        /* Layer control styling */
        .layer-control {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
        
        .layer-item {
            margin: 5px 0;
            cursor: pointer;
        }
        
        .layer-item input {
            margin-right: 5px;
        }
        
        /* Custom icon styling */
        .custom-div-icon {
            background: none;
            border: none;
        }
        
        .custom-div-icon i {
            font-size: 24px; /* Increased size */
            text-shadow: 0px 0px 3px white, 0px 0px 5px white; /* Add outline for better visibility */
        }
    </style>
</head>
<body>
    <!-- Map container -->
    <div id="map"></div>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Font Awesome JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <!-- Optional: Leaflet Fullscreen plugin JS -->
    <script src="https://unpkg.com/leaflet-fullscreen@1.0.2/dist/leaflet.fullscreen.js"></script>
    <script>
        // Initialize map
        var map = L.map('map', {
            fullscreenControl: true, // Enable fullscreen control
        }).setView([37.0902, -95.7129], 5); // Centered on US (latitude, longitude)
        
        // Add tile layer (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Create layer groups to allow toggling
        var federalPrisonsLayer = L.layerGroup().addTo(map);
        var militaryBasesLayer = L.layerGroup().addTo(map);
        var statePrisonsLayer = L.layerGroup().addTo(map);
        var doxLayer = L.layerGroup().addTo(map);
        
        // Define styles for different GeoJSON layers
        var federalPrisonsStyle = {
            color: "#FF0000",
            weight: 1,
            opacity: 0.7,
            fillOpacity: 0.5
        };
        
        var militaryBasesStyle = {
            color: "#0000FF",
            weight: 1,
            opacity: 0.7,
            fillOpacity: 0.5
        };
        
        var statePrisonsStyle = {
            color: "#FF6600",
            weight: 1,
            opacity: 0.7,
            fillOpacity: 0.5
        };
        
        var doxStyle = {
            color: "#008000",
            weight: 1,
            opacity: 0.7,
            fillOpacity: 0.5
        };
        
        // Custom icon creation function using Font Awesome
        function createCustomIcon(icon, markerColor) {
            return L.divIcon({
                html: '<i class="fa ' + icon + '" style="color: ' + markerColor + '"></i>',
                iconSize: [30, 30], // Increased size
                iconAnchor: [15, 15], // Center of the icon
                className: 'custom-div-icon'
            });
        }
        
        // Function to create popup content
        function createPopupContent(feature, layer) {
            if (feature.properties) {
                var popupContent = "<div>";
                for (var key in feature.properties) {
                    popupContent += "<strong>" + key + ":</strong> " + feature.properties[key] + "<br>";
                }
                popupContent += "</div>";
                layer.bindPopup(popupContent);
            }
        }
        
        // Load Federal Prisons GeoJSON
        fetch('FederalPrisons.geojson')
            .then(response => response.json())
            .then(data => {
                var federalPrisons = L.geoJSON(data, {
                    style: federalPrisonsStyle,
                    onEachFeature: createPopupContent,
                    pointToLayer: function(feature, latlng) {
                        return L.marker(latlng, {
                            icon: createCustomIcon('fa-building', '#FF0000')
                        });
                    }
                }).addTo(federalPrisonsLayer);
                
                // Auto-adjust zoom to fit all features if needed
                // map.fitBounds(federalPrisons.getBounds());
            })
            .catch(error => console.error('Error loading Federal Prisons GeoJSON:', error));
        
        // Load Military Bases GeoJSON
        fetch('MilitaryBases.geojson')
            .then(response => response.json())
            .then(data => {
                var militaryBases = L.geoJSON(data, {
                    style: militaryBasesStyle,
                    onEachFeature: createPopupContent,
                    pointToLayer: function(feature, latlng) {
                        return L.marker(latlng, {
                            icon: createCustomIcon('fa-shield-alt', '#0000FF')
                        });
                    }
                }).addTo(militaryBasesLayer);
            })
            .catch(error => console.error('Error loading Military Bases GeoJSON:', error));
        
        // Load State Prisons GeoJSON
        fetch('StatePrisons.geojson')
            .then(response => response.json())
            .then(data => {
                var statePrisons = L.geoJSON(data, {
                    style: statePrisonsStyle,
                    onEachFeature: createPopupContent,
                    pointToLayer: function(feature, latlng) {
                        return L.marker(latlng, {
                            icon: createCustomIcon('fa-building', '#FF6600')
                        });
                    }
                }).addTo(statePrisonsLayer);
            })
            .catch(error => console.error('Error loading State Prisons GeoJSON:', error));
        
        // Load dox GeoJSON
        fetch('dox.geojson')
            .then(response => response.json())
            .then(data => {
                var dox = L.geoJSON(data, {
                    style: doxStyle,
                    onEachFeature: createPopupContent,
                    pointToLayer: function(feature, latlng) {
                        return L.marker(latlng, {
                            icon: createCustomIcon('fa-info-circle', '#008000')
                        });
                    }
                }).addTo(doxLayer);
            })
            .catch(error => console.error('Error loading dox GeoJSON:', error));
        
        // Create layer control
        var layerControl = L.control({position: 'topright'});
        layerControl.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'layer-control');
            div.innerHTML = '<h4>Toggle Layers</h4>';
            
            div.innerHTML += '<div class="layer-item"><input type="checkbox" id="federal-prisons" checked><label for="federal-prisons"><i class="fa fa-building" style="color: #FF0000;"></i> Federal Prisons</label></div>';
            div.innerHTML += '<div class="layer-item"><input type="checkbox" id="military-bases" checked><label for="military-bases"><i class="fa fa-shield-alt" style="color: #0000FF;"></i> Military Bases</label></div>';
            div.innerHTML += '<div class="layer-item"><input type="checkbox" id="state-prisons" checked><label for="state-prisons"><i class="fa fa-building" style="color: #FF6600;"></i> State Prisons</label></div>';
            div.innerHTML += '<div class="layer-item"><input type="checkbox" id="dox" checked><label for="dox"><i class="fa fa-info-circle" style="color: #008000;"></i> Other Data</label></div>';
            
            // Prevent clicks on control from propagating to map
            L.DomEvent.disableClickPropagation(div);
            
            return div;
        };
        layerControl.addTo(map);
        
        // Add event listeners for layer toggling
        document.addEventListener('DOMContentLoaded', function() {
            // Helper function to add event listeners
            function addToggleListener(id, layer) {
                var element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        if (this.checked) {
                            map.addLayer(layer);
                        } else {
                            map.removeLayer(layer);
                        }
                    });
                }
            }
            
            // Add listeners to each checkbox
            addToggleListener('federal-prisons', federalPrisonsLayer);
            addToggleListener('military-bases', militaryBasesLayer);
            addToggleListener('state-prisons', statePrisonsLayer);
            addToggleListener('dox', doxLayer);
        });
        
        // Add a scale control to the map
        L.control.scale().addTo(map);
        
        // Make icons resize with zoom level
        map.on('zoomend', function() {
            var currentZoom = map.getZoom();
            var baseSize = 24; // Base size at zoom level 10
            var zoomFactor = Math.max(0.5, currentZoom / 10); // Adjust scaling factor
            var newSize = Math.round(baseSize * zoomFactor);
            
            document.querySelectorAll('.custom-div-icon i').forEach(function(icon) {
                icon.style.fontSize = newSize + 'px';
            });
        });
    </script>
</body>
</html>
