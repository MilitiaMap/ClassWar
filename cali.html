<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>California Counties with Detention Facilities</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
        }
        .header {
            background-color: #0066cc;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        .home-link {
            background-color: white;
            color: #0066cc;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .home-link:hover {
            background-color: #f0f0f0;
        }
        #map {
            height: calc(100vh - 70px);
            width: 100%;
        }
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            max-width: 250px;
        }
        .legend h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .facility-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            max-width: 300px;
            max-height: 300px;
            overflow-y: auto;
        }
        .facility-info h3 {
            margin-top: 0;
            color: #0066cc;
        }
        .facility-info.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>California Counties with Detention Facilities</h1>
        <a href="index.html" class="home-link">‚Üê Back to Homepage</a>
    </div>
    
    <div id="map"></div>
    
    <div class="facility-info hidden" id="facilityInfo">
        <h3 id="facilityName">Facility Name</h3>
        <div id="facilityDetails"></div>
    </div>
    
    <div class="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #e74c3c;"></div>
            <span>ICE Detention Facility</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #3498db;"></div>
            <span>Federal Prison</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #9b59b6;"></div>
            <span>State Prison</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #f39c12;"></div>
            <span>Private Detention Facility</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([37.1, -119.5], 6);
        const facilityInfo = document.getElementById('facilityInfo');
        const facilityName = document.getElementById('facilityName');
        const facilityDetails = document.getElementById('facilityDetails');

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Define facility data
        const facilities = [
            // ICE Detention Facilities
            {
                name: "Adelanto ICE Processing Center",
                type: "ICE Detention Facility",
                address: "10400 Rancho Road, Adelanto, CA 92301",
                coordinates: [34.5594, -117.4103],
                details: "Capacity: 1,940 beds<br>Primary Customer: ICE<br>Operator: GEO Group"
            },
            {
                name: "Mesa Verde ICE Processing Facility",
                type: "ICE Detention Facility",
                address: "425 Golden State Avenue, Bakersfield, CA 93301",
                coordinates: [35.3782, -119.0211],
                details: "Capacity: 400 beds<br>Primary Customer: ICE<br>Operator: GEO Group"
            },
            {
                name: "Imperial Regional Detention Facility",
                type: "ICE Detention Facility",
                address: "1564 Gateway Road, Calexico, CA 92231",
                coordinates: [32.6787, -115.5068],
                details: "Primary Customer: ICE"
            },
            {
                name: "Otay Mesa Detention Center",
                type: "ICE Detention Facility",
                address: "San Diego, CA",
                coordinates: [32.5592, -116.9735],
                details: "Primary Customer: ICE"
            },
            {
                name: "Central Valley Annex",
                type: "ICE Detention Facility",
                address: "254 Taylor Avenue, McFarland, CA 93250",
                coordinates: [35.6780, -119.2290],
                details: "Capacity: 700 beds<br>Primary Customers: ICE/USMS<br>Operator: GEO Group"
            },
            {
                name: "Desert View Annex",
                type: "ICE Detention Facility",
                address: "10450 Rancho Rd, Adelanto, CA 92301",
                coordinates: [34.5594, -117.4073],
                details: "Capacity: 750 beds<br>Primary Customer: ICE<br>Operator: GEO Group"
            },
            {
                name: "Golden State Annex",
                type: "ICE Detention Facility",
                address: "611 Frontage Road, McFarland, CA 93250",
                coordinates: [35.6776, -119.2310],
                details: "Capacity: 700 beds<br>Primary Customer: ICE<br>Operator: GEO Group"
            },
            
            // State Prisons
            {
                name: "San Quentin State Prison",
                type: "State Prison",
                address: "San Quentin, CA 94964",
                coordinates: [37.9427, -122.4849],
                details: "One of the oldest prisons in California, established in 1852<br>Operator: CDCR"
            },
            {
                name: "Folsom State Prison",
                type: "State Prison",
                address: "Represa, CA 95671",
                coordinates: [38.6926, -121.1760],
                details: "Established in 1880<br>Operator: CDCR"
            },
            {
                name: "California State Prison, Los Angeles County",
                type: "State Prison",
                address: "44750 60th Street West, Lancaster, CA 93536",
                coordinates: [34.6717, -118.2044],
                details: "Operator: CDCR"
            },
            
            // Private Detention Facilities
            {
                name: "California City Correctional Facility",
                type: "Private Detention Facility",
                address: "22844 Virginia Boulevard, California City, CA 93505",
                coordinates: [35.1249, -117.9103],
                details: "Operated by CDCR, owned by CoreCivic"
            },
            {
                name: "Taft Correctional Institution",
                type: "Private Detention Facility",
                address: "1500 Cadet Road, Taft, CA 93268",
                coordinates: [35.1405, -119.4617],
                details: "Operated by Management and Training Corporation"
            },
            
            // ICE-ERO Facilities
            {
                name: "ICE-ERO Los Angeles",
                type: "ICE Detention Facility",
                address: "300 N Los Angeles Street, Suite 7621, Los Angeles, CA 90012",
                coordinates: [34.0554, -118.2406],
                details: "Immigration bonds facility"
            },
            {
                name: "ICE-ERO San Diego",
                type: "ICE Detention Facility",
                address: "880 Front Street Suite 2242, San Diego, CA 92101",
                coordinates: [32.7174, -117.1689],
                details: "Immigration bonds facility"
            },
            {
                name: "ICE-ERO El Centro",
                type: "ICE Detention Facility",
                address: "2051 N. Waterman Avenue, Suite 101, El Centro, CA 92243",
                coordinates: [32.8007, -115.5679],
                details: "Immigration bonds facility"
            },
            {
                name: "ICE-ERO Sacramento",
                type: "ICE Detention Facility",
                address: "650 Capitol Mall, Sacramento, CA 95814",
                coordinates: [38.5810, -121.5038],
                details: "Immigration bonds facility"
            },
            {
                name: "ICE-ERO Bakersfield",
                type: "ICE Detention Facility",
                address: "800 Truxtun Avenue, Bakersfield, CA 93301",
                coordinates: [35.3705, -119.0216],
                details: "Immigration bonds facility"
            },
            {
                name: "ICE-ERO San Francisco",
                type: "ICE Detention Facility",
                address: "630 Sansome Street, San Francisco, CA 94111",
                coordinates: [37.7957, -122.4011],
                details: "Immigration bonds facility"
            }
        ];

        // Function to get marker color based on facility type
        function getMarkerColor(type) {
            switch(type) {
                case "ICE Detention Facility":
                    return "#e74c3c"; // Red
                case "Federal Prison":
                    return "#3498db"; // Blue
                case "State Prison":
                    return "#9b59b6"; // Purple
                case "Private Detention Facility":
                    return "#f39c12"; // Orange
                default:
                    return "#2ecc71"; // Green
            }
        }

        // Add facility markers
        facilities.forEach(facility => {
            const markerColor = getMarkerColor(facility.type);
            
            // Create a custom icon
            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="${markerColor}">
                        <path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/>
                       </svg>`,
                iconSize: [24, 24],
                iconAnchor: [12, 24],
                popupAnchor: [0, -24]
            });
            
            const marker = L.marker(facility.coordinates, {icon: customIcon}).addTo(map);
            
            marker.on('click', function() {
                facilityName.textContent = facility.name;
                facilityDetails.innerHTML = `
                    <p><strong>Type:</strong> ${facility.type}</p>
                    <p><strong>Address:</strong> ${facility.address}</p>
                    <p><strong>Details:</strong><br>${facility.details}</p>
                `;
                facilityInfo.classList.remove('hidden');
            });
        });

        // GeoJSON for California counties
        fetch('https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/california-counties.geojson')
            .then(response => response.json())
            .then(data => {
                // Add GeoJSON layer with county styling
                L.geoJSON(data, {
                    style: function() {
                        return {
                            color: '#3388ff',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.05,
                            fillColor: '#3388ff'
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        // Add county name to appear on hover
                        if (feature.properties && feature.properties.name) {
                            layer.bindTooltip(feature.properties.name + " County");
                        }
                    }
                }).addTo(map);
            })
            .catch(error => {
                console.error('Error loading GeoJSON:', error);
                // If there's an error, add a basic California outline
                const californiaOutline = L.polygon([
                    [42.0, -124.4], // Northwest corner
                    [42.0, -120.0], // Northeast corner
                    [39.0, -114.6], // East central
                    [35.0, -114.6], // Southeast
                    [32.5, -114.8], // Southern border
                    [32.5, -117.1], // Southwest corner
                    [33.5, -118.5], // Southern coast
                    [34.4, -120.5], // Central coast
                    [35.8, -121.8], // Central coast
                    [38.0, -123.0], // Northern central coast
                    [40.0, -124.2], // Northern coast
                    [41.0, -124.3]  // Northern coast
                ], {
                    color: '#3388ff',
                    weight: 3,
                    fillColor: '#3388ff',
                    fillOpacity: 0.1
                }).addTo(map);
            });

        // Add click handler to close info panel when clicking elsewhere on map
        map.on('click', function(e) {
            // Check if click was on a marker
            let clickedMarker = false;
            map.eachLayer(function(layer) {
                if (layer instanceof L.Marker) {
                    const markerPoint = map.latLngToContainerPoint(layer.getLatLng());
                    const clickPoint = e.containerPoint;
                    const distance = L.point(clickPoint.x - markerPoint.x, clickPoint.y - markerPoint.y).distanceTo([0, 0]);
                    if (distance < 15) {
                        clickedMarker = true;
                    }
                }
            });
            
            if (!clickedMarker) {
                facilityInfo.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
